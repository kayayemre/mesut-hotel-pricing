<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MESUT HOTEL - Fiyat Hesaplama</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            align-items: start;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(20px);
        }

        .user-panel {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .results-panel {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        h1, h2 {
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            color: #333;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .child-ages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .child-ages input {
            text-align: center;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(238, 90, 36, 0.4);
        }

        button:active {
            transform: translateY(-1px);
        }

        .results {
            min-height: 400px;
            overflow-y: auto;
        }

        .result-header {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .result-header h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .result-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .price-option {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #fff;
            transition: all 0.3s ease;
        }

        .price-option:hover {
            background: rgba(255,255,255,0.25);
            transform: translateX(5px);
        }

        .price-option h4 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #fff;
        }

        .price-option .price {
            font-size: 24px;
            font-weight: 900;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .api-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .api-endpoint {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 15px 0;
            color: #ffeb3b;
        }

        .loading {
            text-align: center;
            font-size: 18px;
            color: #fff;
            margin: 50px 0;
        }

        .error {
            background: rgba(255,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            color: #fff;
            margin: 20px 0;
            border-left: 5px solid #ff4444;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Hesaplama Paneli -->
        <div class="card user-panel">
            <h1>üè® MESUT HOTEL</h1>
            <h2>Konaklama Fiyat Hesaplama</h2>
            
            <div class="form-group">
                <label>üìÖ Giri≈ü Tarihi:</label>
                <input type="date" id="checkinDate" required>
            </div>

            <div class="form-group">
                <label>üìÖ √áƒ±kƒ±≈ü Tarihi:</label>
                <input type="date" id="checkoutDate" required>
            </div>

            <div class="form-group">
                <label>üë• Yeti≈ükin Sayƒ±sƒ±:</label>
                <select id="adultCount">
                    <option value="1">1 Yeti≈ükin</option>
                    <option value="2" selected>2 Yeti≈ükin</option>
                    <option value="3">3 Yeti≈ükin</option>
                    <option value="4">4 Yeti≈ükin</option>
                    <option value="5">5 Yeti≈ükin</option>
                    <option value="6">6 Yeti≈ükin</option>
                </select>
            </div>

            <div class="form-group">
                <label>üë∂ √áocuk Sayƒ±sƒ±:</label>
                <select id="childCount" onchange="updateChildAges()">
                    <option value="0" selected>√áocuk Yok</option>
                    <option value="1">1 √áocuk</option>
                    <option value="2">2 √áocuk</option>
                    <option value="3">3 √áocuk</option>
                    <option value="4">4 √áocuk</option>
                </select>
            </div>

            <div class="form-group" id="childAgesGroup" style="display: none;">
                <label>üéÇ √áocuk Ya≈ülarƒ±:</label>
                <div class="child-ages" id="childAges">
                </div>
            </div>

            <button onclick="calculatePrice()">üí∞ Fƒ∞YAT HESAPLA</button>

            <div class="api-section">
                <h3>üîó API Endpoint</h3>
                <p>Bot entegrasyonu i√ßin:</p>
                <div class="api-endpoint">
                    GET /?api=calculate&message=15 temmuz 4 gece 2 yetiskin 1 cocuk
                </div>
            </div>
        </div>

        <!-- Sonu√ßlar Paneli -->
        <div class="card results-panel">
            <h1>üíé Fiyat Teklifleri</h1>
            
            <div class="results" id="results">
                <div style="text-align: center; padding: 50px; opacity: 0.7;">
                    <h3>Fiyat hesaplamasƒ± i√ßin sol panelden bilgileri girin</h3>
                    <p>Tarih, ki≈üi sayƒ±sƒ± ve √ßocuk ya≈ülarƒ±nƒ± girip "Fiyat Hesapla" butonuna basƒ±n</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // MESUT HOTEL Fƒ∞YAT VERƒ∞TABANI
        const priceDatabase = {
            "standart": {
                "2025-06-25_2025-07-10": 2500,
                "2025-07-11_2025-09-19": 3175,
                "2025-09-20_2025-09-30": 3780,
                "2025-10-01_2025-10-15": 3180,
                "2025-10-16_2025-10-31": 2255
            }
        };

        // MESUT HOTEL √áARPAN TABLOSU
        const multiplierTable = {
            "1_0": 1.7,      // 1 yeti≈ükin
            "1_1": 1.7,      // 1 yeti≈ükin + 1 √ßocuk
            "1_2": 2.0,      // 1 yeti≈ükin + 2 √ßocuk
            "2_0": 2.0,      // 2 yeti≈ükin
            "2_1": 2.0,      // 2 yeti≈ükin + 1 √ßocuk
            "3_0": 2.7       // 3 yeti≈ükin
        };

        // Geli≈ümi≈ü mesaj parse fonksiyonu
        function parseMessage(text) {
            text = text.toLowerCase().replace(/ƒ±/g, 'i').replace(/ƒü/g, 'g').replace(/√º/g, 'u').replace(/≈ü/g, 's').replace(/√∂/g, 'o').replace(/√ß/g, 'c');
            
            // Tarih bulma
            let checkin = '', checkout = '';
            const currentYear = new Date().getFullYear();
            
            // Ay isimleri
            const months = {
                'haziran': '06', 'temmuz': '07', 'agustos': '08', 
                'eylul': '09', 'ekim': '10', 'kasim': '11'
            };
            
            // "12 temmuz" formatƒ±
            const dateMatch = text.match(/(\d{1,2})\s*(haziran|temmuz|agustos|eylul|ekim|kasim)/);
            if (dateMatch) {
                const day = dateMatch[1].padStart(2, '0');
                const month = months[dateMatch[2]];
                checkin = `${currentYear}-${month}-${day}`;
            }
            
            // Gece sayƒ±sƒ± bulma
            let nights = 5; // default
            const nightMatch = text.match(/(\d+)\s*(gece|gun)/);
            if (nightMatch) {
                nights = parseInt(nightMatch[1]);
            }
            
            // Checkout tarihi hesapla
            if (checkin) {
                const checkinDate = new Date(checkin);
                checkinDate.setDate(checkinDate.getDate() + nights);
                checkout = checkinDate.toISOString().split('T')[0];
            }
            
            // Yeti≈ükin sayƒ±sƒ±
            let adults = 2; // default
            const adultMatches = [
                /(\d+)\s*(yetiskin|yetiskn|adult)/,
                /(bir|iki|uc|dort|bes)\s*(yetiskin|adult)/,
                /(\d+)\s*kisil?i?k/
            ];
            
            for (let pattern of adultMatches) {
                const match = text.match(pattern);
                if (match) {
                    if (match[1] === 'bir') adults = 1;
                    else if (match[1] === 'iki') adults = 2;
                    else if (match[1] === 'uc') adults = 3;
                    else adults = parseInt(match[1]) || 2;
                    break;
                }
            }
            
            // √áocuk sayƒ±sƒ± ve ya≈ülarƒ±
            let children = [];
            const childMatches = [
                /(\d+)\s*(cocuk|cck|child).*?(\d+)\s*yas/,
                /(\d+)\s*yas.*?(\d+)\s*(cocuk|cck)/,
                /(\d+)\s*(cocuk|cck)/
            ];
            
            for (let pattern of childMatches) {
                const match = text.match(pattern);
                if (match) {
                    if (match[3]) {
                        // Ya≈ü bulundu
                        children = [parseInt(match[3])];
                    } else {
                        // Sadece √ßocuk sayƒ±sƒ±, ya≈ü 5 varsayalƒ±m
                        children = [5];
                    }
                    break;
                }
            }
            
            return { checkin, checkout, adults, children };
        }

        // API kontrol√º - sayfa y√ºklendiƒüinde hemen √ßalƒ±≈üsƒ±n
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('api') && urlParams.get('api') === 'calculate') {
            const message = urlParams.get('message');
            if (message) {
                try {
                    const data = parseMessage(message);
                    const result = calculatePriceAPI(data);
                    
                    const response = `Giri≈ü: ${formatDate(new Date(data.checkin))}
√áƒ±kƒ±≈ü: ${formatDate(new Date(data.checkout))}
${result.nights} Gece ${result.nights + 1} G√ºn
${result.adultCount} Yeti≈ükin${result.childAges.length > 0 ? ` + ${result.childAges.length} √áocuk (${result.childAges.join('-')} ya≈ü)` : ''}

Standart Oda - Her≈üey Dahil
${formatPrice(result.results[0].price)}`;
                    
                    document.body.innerHTML = `<pre style="padding: 20px; font-family: Arial; white-space: pre-wrap;">${response}</pre>`;
                } catch (error) {
                    document.body.innerHTML = `<div style="padding: 20px; color: red;">Hata: ${error.message}</div>`;
                }
            }
        }

        // Sayfa y√ºklendiƒüinde tarih ayarla
        window.onload = function() {
            const currentYear = new Date().getFullYear();
            document.getElementById('checkinDate').value = `${currentYear}-07-14`;
            document.getElementById('checkoutDate').value = `${currentYear}-07-19`;
            document.getElementById('childCount').value = '1';
            updateChildAges();
            setTimeout(() => {
                document.getElementById('childAge0').value = '5';
            }, 100);
        };

        function updateChildAges() {
            const childCount = parseInt(document.getElementById('childCount').value);
            const childAgesGroup = document.getElementById('childAgesGroup');
            const childAgesContainer = document.getElementById('childAges');
            
            if (childCount === 0) {
                childAgesGroup.style.display = 'none';
                return;
            }
            
            childAgesGroup.style.display = 'block';
            childAgesContainer.innerHTML = '';
            
            for (let i = 0; i < childCount; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.min = '0';
                input.max = '17';
                input.placeholder = `${i + 1}. √ßocuk`;
                input.id = `childAge${i}`;
                input.required = true;
                childAgesContainer.appendChild(input);
            }
        }

        function getDaysBetweenDates(startDate, endDate) {
            const oneDay = 24 * 60 * 60 * 1000;
            return Math.round((endDate - startDate) / oneDay);
        }

        function getDailyPrice(date, roomType) {
            const dateStr = date.toISOString().split('T')[0];
            
            for (const [period, price] of Object.entries(priceDatabase[roomType])) {
                const [startDate, endDate] = period.split('_');
                if (dateStr >= startDate && dateStr <= endDate) {
                    return price;
                }
            }
            return 0;
        }

        function calculateTotalPrice(checkinDate, checkoutDate, roomType) {
            let totalPrice = 0;
            const currentDate = new Date(checkinDate);
            
            while (currentDate < checkoutDate) {
                totalPrice += getDailyPrice(currentDate, roomType);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return totalPrice;
        }

        function formatDate(date) {
            const days = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'];
            const months = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 
                          'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            
            const dayName = days[date.getDay()];
            const day = date.getDate();
            const monthName = months[date.getMonth()];
            
            return `${day} ${monthName} ${dayName}`;
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('tr-TR').format(price) + ' TL';
        }

        async function calculatePrice() {
            const checkinDateStr = document.getElementById('checkinDate').value;
            const checkoutDateStr = document.getElementById('checkoutDate').value;
            const adultCount = parseInt(document.getElementById('adultCount').value);
            const childCount = parseInt(document.getElementById('childCount').value);
            
            if (!checkinDateStr || !checkoutDateStr) {
                alert('L√ºtfen giri≈ü ve √ßƒ±kƒ±≈ü tarihlerini se√ßin!');
                return;
            }

            const checkinDate = new Date(checkinDateStr);
            const checkoutDate = new Date(checkoutDateStr);
            
            if (checkinDate >= checkoutDate) {
                alert('√áƒ±kƒ±≈ü tarihi giri≈ü tarihinden sonra olmalƒ±dƒ±r!');
                return;
            }

            // √áocuk ya≈ülarƒ±nƒ± al
            const childAges = [];
            for (let i = 0; i < childCount; i++) {
                const age = parseInt(document.getElementById(`childAge${i}`).value);
                if (isNaN(age) || age < 0 || age > 17) {
                    alert(`L√ºtfen ${i + 1}. √ßocuƒüun ya≈üƒ±nƒ± doƒüru girin (0-17 arasƒ±)!`);
                    return;
                }
                childAges.push(age);
            }

            // Loading g√∂ster
            document.getElementById('results').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Fiyatlar hesaplanƒ±yor...</p>
                </div>
            `;

            // Kƒ±sa bir delay ekle (ger√ßek hesaplama i√ßin)
            await new Promise(resolve => setTimeout(resolve, 1000));

            try {
                const result = performCalculation(checkinDate, checkoutDate, adultCount, childAges);
                displayResults(result);
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        <h3>‚ùå Hata</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function performCalculation(checkinDate, checkoutDate, adultCount, childAges) {
            // Ya≈ü kontrol√º (13 ya≈ü √ºst√º yeti≈ükin sayƒ±lƒ±r)
            let finalAdultCount = adultCount;
            let finalChildAges = [];
            
            childAges.forEach(age => {
                if (age >= 13) {
                    finalAdultCount++;
                } else if (age >= 2) { // 2 ya≈ü √ºst√º √ßocuk sayƒ±lƒ±r
                    finalChildAges.push(age);
                }
                // 0-1 ya≈ü bebek sayƒ±lmaz (hesaplamaya katƒ±lmaz)
            });

            const nights = getDaysBetweenDates(checkinDate, checkoutDate);
            const combinationKey = `${finalAdultCount}_${finalChildAges.length}`;
            
            let results = [];

            // √áarpan kontrol√º
            if (multiplierTable[combinationKey]) {
                const multiplier = multiplierTable[combinationKey];
                
                // Mesut Hotel i√ßin sadece Standart Oda
                const basePrice = calculateTotalPrice(checkinDate, checkoutDate, 'standart');
                const finalPrice = Math.round(basePrice * multiplier);
                
                results.push({
                    roomType: 'Standart Oda',
                    concept: 'Her≈üey Dahil',
                    price: finalPrice,
                    roomCount: 1
                });
            } else {
                // √áarpan tablosunda yoksa hata
                throw new Error(`${finalAdultCount} yeti≈ükin + ${finalChildAges.length} √ßocuk kombinasyonu i√ßin fiyatlandƒ±rma mevcut deƒüil. L√ºtfen rezervasyon b√∂l√ºm√ºm√ºzle ileti≈üime ge√ßin.`);
            }

            return {
                checkinDate,
                checkoutDate,
                nights,
                adultCount: finalAdultCount,
                childAges: childAges, // Orijinal ya≈ülar (bebek dahil)
                finalChildAges,
                results
            };
        }

        function displayResults(data) {
            const { checkinDate, checkoutDate, nights, adultCount, childAges, results } = data;
            
            // √áocuk ya≈ü string'i olu≈ütur
            let childAgeStr = '';
            if (childAges.length > 0) {
                childAgeStr = ` + ${childAges.length} √áocuk (${childAges.join('-')} ya≈ü)`;
            }

            const resultHtml = `
                <div class="result-header">
                    <h3>üìÖ ${formatDate(checkinDate)} - ${formatDate(checkoutDate)}</h3>
                    <p><strong>${nights} Gece ${nights + 1} G√ºn</strong></p>
                    <p><strong>${adultCount} Yeti≈ükin${childAgeStr}</strong></p>
                </div>
                
                ${results.map(result => `
                    <div class="price-option">
                        <h4>${result.roomCount > 1 ? `${result.roomCount} Tane ` : ''}${result.roomType} - ${result.concept}</h4>
                        <div class="price">${formatPrice(result.price)}</div>
                    </div>
                `).join('')}
            `;
            
            document.getElementById('results').innerHTML = resultHtml;
        }

        // API endpoint sim√ºlasyonu
        window.calculatePriceAPI = function(data) {
            const checkinDate = new Date(data.checkin);
            const checkoutDate = new Date(data.checkout);
            const adultCount = data.adults;
            const childAges = data.children || [];
            
            return performCalculation(checkinDate, checkoutDate, adultCount, childAges);
        };
    </script>
</body>
</html>
